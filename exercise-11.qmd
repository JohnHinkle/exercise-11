---
title: "exercise-11"
author: "John Hinkle"
format: html
self-contained: true
editor: visual
---

## Load packages and data

```{r}
library(tidyverse)
library(skimr)
d <- read_tsv("https://raw.githubusercontent.com/difiore/ada-datasets/main/Mammal_lifehistories_v2.txt")
head(d)
```

## Exploratory analysis

According to skim(), there are 10 numeric variables- but I assume that there are actually 9 as "refs"(reference number?) is not intended to be a numeric variable.

```{r}
skim(d)
```

## Step 1: Replace -999 with NA

```{r}
d <- naniar::replace_with_na_all(data = d, condition = ~.x == -999)
```

## Step 2: Drop "litter size" and "refs" variables

```{r}
d <- d |>
  select(c(-`litter size`, -refs))
```

## Step 3: Log transform numeric variables

```{r}
d <- d |>
  mutate(across(where(is.numeric), log))
```

## Step 4a: Run linear models to obtain residuals

```{r}
m1 <- lm(data = d, `gestation(mo)` ~ `mass(g)`, na.action=na.exclude)
m2 <- lm(data = d, `weaning(mo)` ~ `mass(g)`, na.action=na.exclude)
m3 <- lm(data = d, `AFR(mo)` ~ `mass(g)`, na.action=na.exclude)
m4 <- lm(data = d, `max. life(mo)` ~ `mass(g)`, na.action=na.exclude)
m5 <- lm(data = d, `newborn(g)` ~ `mass(g)`, na.action=na.exclude)
m6 <- lm(data = d, `wean mass(g)` ~ `mass(g)`, na.action=na.exclude)
```

## Step 4b: Add new variables to the data set

```{r}
d <- d |>
  mutate(relGest = residuals(m1),
         relWean = residuals(m2),
         relAFR = residuals(m3),
         relLife = residuals(m4),
         relNewbornMass = residuals(m5),
         relWeaningMass = residuals(m6))
```

## Step 5a: Relative maximum lifespan by Order

```{r}
ggplot(data = d, aes(x = order, y = relLife)) +
  geom_boxplot() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
```

## Step 5b: Relative newborn mass by Order

```{r}
ggplot(data = d, aes(x = order, y = relNewbornMass)) +
  geom_boxplot() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
```

## Step 5c: Relative weaning mass by Order

```{r}
ggplot(data = d, aes(x = order, y = relWeaningMass)) +
  geom_boxplot() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
```

## Step 6a: Run linear models

```{r}
d <- drop_na(d)

m7 <- lm(data = d, `max. life(mo)` ~ `gestation(mo)`)
m8 <- lm(data = d, `max. life(mo)` ~ `newborn(g)`)
m9 <- lm(data = d, `max. life(mo)` ~ `weaning(mo)`)
m10 <- lm(data = d, `max. life(mo)` ~ `wean mass(g)`)
m11 <- lm(data = d, `max. life(mo)` ~ `mass(g)`)

m12 <- lm(data = d, `AFR(mo)` ~ `gestation(mo)`)
m13 <- lm(data = d, `AFR(mo)` ~ `newborn(g)`)
m14 <- lm(data = d, `AFR(mo)` ~ `weaning(mo)`)
m15 <- lm(data = d, `AFR(mo)` ~ `wean mass(g)`)
m16 <- lm(data = d, `AFR(mo)` ~ `mass(g)`)
```

## Step 6b: Model evaluation

The best predictor of maximum lifespan is gestation period. No other models have a delta AICc of ≤4.

The best predictor of age at first reproduction is gestation period. No other models have a delta AICc of ≤4.

```{r}
library(AICcmodavg)

aictab(list(m7, m8, m9, m10, m11), c("`max. life(mo)` ~ `gestation(mo)`", 
                                     "`max. life(mo)` ~ `newborn(g)`", 
                                     "`max. life(mo)` ~ `weaning(mo)`",
                                     "`max. life(mo)` ~ `wean mass(g)`", 
                                     "`max. life(mo)` ~ `mass(g)`"))
aictab(list(m12, m13, m14, m15, m16), c("`AFR(mo)` ~ `gestation(mo)`", 
                                        "`AFR(mo)` ~ `newborn(g)`", 
                                        "`AFR(mo)` ~ `weaning(mo)`",
                                        "`AFR(mo)` ~ `wean mass(g)`", 
                                        "`AFR(mo)` ~ `mass(g)`"))
```
